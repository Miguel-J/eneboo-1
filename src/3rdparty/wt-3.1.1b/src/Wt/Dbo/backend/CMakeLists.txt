OPTION( USE_SYSTEM_SQLITE3 "Use system-wide Sqlite3 instead of Wt's version" OFF)

IF(USE_SYSTEM_SQLITE3)
  FIND_PACKAGE( Sqlite3 REQUIRED)
ELSE(USE_SYSTEM_SQLITE3)
  SET(Sqlite3_SRCS amalgamation/sqlite3.c)
ENDIF(USE_SYSTEM_SQLITE3)

ADD_LIBRARY(wtdbosqlite3
  Sqlite3.C
  ${Sqlite3_SRCS}
)

TARGET_LINK_LIBRARIES(wtdbosqlite3 wtdbo ${SQLITE3_LIBRARIES})

IF(NOT WIN32)
  TARGET_LINK_LIBRARIES(wtdbosqlite3 dl)
ENDIF(NOT WIN32)

INSTALL(TARGETS wtdbosqlite3
    RUNTIME DESTINATION bin
    LIBRARY DESTINATION ${LIB_INSTALL_DIR}
    ARCHIVE DESTINATION ${LIB_INSTALL_DIR})

SET_TARGET_PROPERTIES(
  wtdbosqlite3
PROPERTIES
  VERSION ${VERSION_SERIES}.${VERSION_MAJOR}.${VERSION_MINOR}
  SOVERSION ${WTDBO_SOVERSION}
  DEBUG_POSTFIX "d"
)

INSTALL_FILES(/include/Wt/Dbo/backend "^Sqlite3$")
